
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lære å lese: Stave og lese</title>
    <style>
        body {
            font-family: 'Comic Sans MS', sans-serif;
            text-align: center;
            background-color: #f0f8ff;
            padding: 20px;
            touch-action: manipulation;
            background-color: lightgray;
        }
        .game-container {
            max-width: 600px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .picture {
            height: 200px;
            margin: 20px 0;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }
        .letter-container {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            min-height: 70px;
        }
        .letter-box {
            width: 60px;
            height: 60px;
            border: 2px dashed #aaa;
            margin: 0 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 32px;
            font-weight: bold;
            background-color: #f9f9f9;
            border-radius: 10px;
            transition: all 0.2s;
            touch-action: none;
        }
        .letter-box.highlight {
            background-color: #e3f2fd;
            border-color: #2196F3;
        }
        .letter-box.filled {
            border-style: solid;
            background-color: white;
        }
        .letter-options {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
            min-height: 70px;
        }
        .letter-option {
            width: 50px;
            height: 50px;
            border: 2px solid #4CAF50;
            margin: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 28px;
            font-weight: bold;
            background-color: #e8f5e9;
            cursor: grab;
            border-radius: 8px;
            user-select: none;
            transition: all 0.2s;
            touch-action: none;
        }
        .letter-option:hover {
            background-color: #c8e6c9;
            transform: scale(1.1);
        }
        .letter-option.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }
        .letter-option.hidden {
            visibility: hidden;
        }
        .letter-option.returning {
            animation: returnAnimation 0.5s ease-in-out;
        }
        @keyframes returnAnimation {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        .correct {
            background-color: #a5d6a7;
            border-color: #4CAF50;
        }
        .incorrect {
            background-color: #ffcdd2;
            border-color: #f44336;
            animation: shake 0.5s;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
            margin-top: 10px;
            transition: all 0.2s;
        }
        button:hover {
            background-color: #388e3c;
            transform: scale(1.05);
        }
        .feedback {
            height: 20px;
            margin: 10px 0;
            font-weight: bold;
        }
        .try-again {
            color: #FF9800;
            font-style: italic;
            margin-top: 10px;
        }
        
        /* Direct navigation styles */
        .direct-navigation {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
            gap: 10px;
        }
        .image-button {
            background-color: #2196F3;
            color: white;
            border: none;
            padding: 10px 15px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.2s;
            min-width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        .image-button:hover {
            background-color: #1976D2;
            transform: scale(1.05);
        }
        .image-button.active {
            background-color: #FF9800;
            font-weight: bold;
            transform: scale(1.1);
        }
        
        /* Touch-specific styles */
        @media (hover: none) {
            .letter-option:hover {
                background-color: #e8f5e9;
                transform: none;
            }
            button:hover {
                background-color: #4CAF50;
                transform: none;
            }
            .image-button:hover {
                background-color: #2196F3;
                transform: none;
            }
        }
        
        /* Dragging letter styles */
        .dragging-letter {
            position: fixed;
            width: 60px;
            height: 60px;
            border: 2px solid #4CAF50;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 32px;
            font-weight: bold;
            background-color: #e8f5e9;
            border-radius: 8px;
            z-index: 1000;
            pointer-events: none;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transform: translate(-50%, -50%);
            transition: none;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>Lære å lese: Stave og lese</h1>
        <p>Dra og drop bokstaver i riktig rekkefølge ord for bilde.</p>
        <p>(Stavelseord med to og tre bokstaver)</p>
        <div id="picture" class="picture"></div>
        
        <div class="letter-container" id="letter-container"></div>
        
        <div class="feedback" id="feedback"></div>
        <div class="try-again" id="try-again"></div>
        
        <div class="letter-options" id="letter-options"></div>
        
        <button id="check-button">Sjekk</button>
        <button id="reset-letters-button">Tilbakestill bokstaver</button>
        
        <div class="direct-navigation" id="direct-navigation">
            <!-- Image buttons will be generated here -->
        </div>
    </div>

    <script>
        // Word list with image URLs
        const wordList = [
            { word: "is", image: "https://cbx-prod.b-cdn.net/COLOURBOX5419855.jpg?width=480&height=480&quality=70" },
            { word: "ris", image: "https://us.123rf.com/450wm/liubovlokhva/liubovlokhva2201/liubovlokhva220100005/181065112-rice-bowl-with-chopsticks-vector-stock-illustration-isolated-on-white-background-for-packaging.jpg" },
            { word: "ål", image: "https://img.freepik.com/vektoren-premium/zeichentrickfilm-aal-dunkelgrau-mit-weissem-unterbauch-freundliches-gesicht-meereslebewesen-suesse-wassertiere-vektor-illustration_109722-7291.jpg" },
            { word: "kål", image: "https://static.vecteezy.com/system/resources/previews/026/912/077/non_2x/cabbage-clipart-generative-ai-png.png" },
            { word: "bål", image: "https://st5.depositphotos.com/78905846/65611/v/450/depositphotos_656111458-stock-illustration-fireplace-bonfire-campfire-vector-illustration.jpg" },
            { word: "mål", image: "https://st3.depositphotos.com/13864334/18844/v/450/depositphotos_188442229-stock-illustration-black-and-white-soccer-gate.jpg" },
            { word: "nål", image: "https://img.freepik.com/vektor-premium/gambar-monokrom-jarum-logam-tajam-dengan-kartun-vektor-benang_543641-1870.jpg" },
            { word: "øy", image: "https://media.istockphoto.com/id/503732021/vector/tropical-island-cartoon.jpg?s=612x612&w=0&k=20&c=LWXfHDNdPvqbezkiH7e22QLrpNMpIFxBH97bgQ4hufc=" },
            { word: "tøy", image: "https://www.minskole.no/StaticContent/ArticleIcons/104.jpg" },
            { word: "høy", image: "https://img.freepik.com/free-vector/hay-stack-roll-farm-design_107791-26930.jpg" },
            { word: "ro", image: "https://www.infobilder.com/img/thumbnails/0/bilde-a%C2%A5-ro-30320.jpg" },
            { word: "rot", image: "https://st3.depositphotos.com/4722431/35129/v/450/depositphotos_351298808-stock-illustration-black-shape-tree-leaves-roots.jpg" },
            { word: "bro", image: "https://cdn.pixabay.com/photo/2015/11/06/12/08/golden-gate-bridge-1026697_640.jpg" },
            { word: "os", image: "https://img.freepik.com/premium-photo/candle-that-has-smoke-coming-out-it_1180276-112.jpg" },
            { word: "ost", image: "https://thumbs.dreamstime.com/b/piece-cheese-13042812.jpg?w=768" },
            { word: "te", image: "https://img.freepik.com/premium-vector/cup-hot-tea-with-brewed-tea-bag-illustration-vector_682199-194.jpg" },
            { word: "le", image: "https://media.baamboozle.com/uploads/images/152514/1644921217_29436.jpeg" },
            { word: "Ole", image: "https://viphuset-i04.mycdn.no/mysimgprod/viphuset_mystore_no/images/10945_Ole_brumm_1.jpg/w500h600.jpg" },
            { word: "tre", image: "https://img.freepik.com/free-vector/tree-with-green-leaves-sticker-white-background_1308-77128.jpg?semt=ais_hybrid&w=740&q=80" },            
            { word: "telle", image: "https://st.depositphotos.com/1002015/1212/v/450/depositphotos_12125184-stock-illustration-set-of-illustrations-of-numbers.jpg" }
        ];
        
        let currentWord = "";
        let currentWordIndex = 0;
        let selectedLetters = [];
        let letterOptions = [];
        let draggedLetter = null;
        let draggedLetterIndex = null;
        let draggedFromContainer = null;
        let isIncorrectAttempt = false;
        let touchStartX = 0;
        let touchStartY = 0;
        let draggingLetterElement = null;
        
        // DOM elements
        const pictureElement = document.getElementById("picture");
        const letterContainer = document.getElementById("letter-container");
        const letterOptionsElement = document.getElementById("letter-options");
        const feedbackElement = document.getElementById("feedback");
        const tryAgainElement = document.getElementById("try-again");
        const checkButton = document.getElementById("check-button");
        const resetLettersButton = document.getElementById("reset-letters-button");
        const directNavigationElement = document.getElementById("direct-navigation");
        
        // Initialize the game
        function initGame() {
            // Set the current word
            currentWord = wordList[currentWordIndex].word;
            
            // Set the picture
            pictureElement.style.backgroundImage = `url(${wordList[currentWordIndex].image})`;
            
            // Clear previous game state
            letterContainer.innerHTML = "";
            letterOptionsElement.innerHTML = "";
            selectedLetters = Array(currentWord.length).fill(null);
            feedbackElement.textContent = "";
            tryAgainElement.textContent = "";
            isIncorrectAttempt = false;
            
            // Update direct navigation buttons
            updateDirectNavigation();
            
            // Create empty letter boxes
            for (let i = 0; i < currentWord.length; i++) {
                const letterBox = document.createElement("div");
                letterBox.className = "letter-box";
                letterBox.dataset.index = i;
                
                // Drag events for letter boxes
                letterBox.addEventListener("dragover", handleDragOver);
                letterBox.addEventListener("dragenter", handleDragEnter);
                letterBox.addEventListener("dragleave", handleDragLeave);
                letterBox.addEventListener("drop", handleDrop);
                letterBox.addEventListener("click", handleBoxClick);
                
                // Touch events for letter boxes
                letterBox.addEventListener("touchstart", handleTouchStart, { passive: false });
                letterBox.addEventListener("touchmove", handleTouchMove, { passive: false });
                letterBox.addEventListener("touchend", handleTouchEnd);
                letterBox.addEventListener("touchcancel", handleTouchEnd);
                
                letterContainer.appendChild(letterBox);
            }
            
            // Create letter options (shuffled)
            letterOptions = [...currentWord].sort(() => Math.random() - 0.5);
            letterOptions.forEach((letter, index) => {
                const letterOption = document.createElement("div");
                letterOption.className = "letter-option";
                letterOption.textContent = letter;
                letterOption.draggable = true;
                letterOption.dataset.index = index;
                letterOption.dataset.letter = letter;
                letterOption.dataset.originalPosition = index;
                
                // Drag events for letter options
                letterOption.addEventListener("dragstart", handleDragStart);
                letterOption.addEventListener("dragend", handleDragEnd);
                
                // Touch events for letter options
                letterOption.addEventListener("touchstart", handleTouchStart, { passive: false });
                letterOption.addEventListener("touchmove", handleTouchMove, { passive: false });
                letterOption.addEventListener("touchend", handleTouchEnd);
                letterOption.addEventListener("touchcancel", handleTouchEnd);
                
                letterOptionsElement.appendChild(letterOption);
            });
        }
        
        // Update direct navigation buttons
        function updateDirectNavigation() {
            directNavigationElement.innerHTML = "";
            
            wordList.forEach((item, index) => {
                const button = document.createElement("button");
                button.className = "image-button";
                button.textContent = index + 1; // Use numbers instead of words
                button.dataset.index = index;
                
                if (index === currentWordIndex) {
                    button.classList.add("active");
                }
                
                button.addEventListener("click", () => {
                    currentWordIndex = index;
                    initGame();
                });
                
                button.addEventListener("touchstart", function(e) {
                    e.preventDefault();
                    currentWordIndex = index;
                    initGame();
                }, { passive: false });
                
                directNavigationElement.appendChild(button);
            });
        }
        
        // Function to return all letters to their original positions
        function resetLetters() {
            // Clear all letter boxes
            const letterBoxes = letterContainer.children;
            for (let i = 0; i < letterBoxes.length; i++) {
                letterBoxes[i].textContent = "";
                letterBoxes[i].className = "letter-box";
                selectedLetters[i] = null;
            }
            
            // Show all letter options with animation
            const options = letterOptionsElement.children;
            for (let i = 0; i < options.length; i++) {
                options[i].classList.remove("hidden");
                options[i].classList.add("returning");
                setTimeout(() => {
                    options[i].classList.remove("returning");
                }, 500);
            }
            
            // Clear feedback
            feedbackElement.textContent = "";
            tryAgainElement.textContent = "";
            isIncorrectAttempt = false;
        }
        
        // Create a visual element that follows the touch point
        function createDraggingLetter(letter, x, y) {
            if (draggingLetterElement) {
                document.body.removeChild(draggingLetterElement);
            }
            
            draggingLetterElement = document.createElement("div");
            draggingLetterElement.className = "dragging-letter";
            draggingLetterElement.textContent = letter;
            draggingLetterElement.style.left = `${x}px`;
            draggingLetterElement.style.top = `${y}px`;
            document.body.appendChild(draggingLetterElement);
        }
        
        // Update the position of the dragging letter
        function updateDraggingLetterPosition(x, y) {
            if (draggingLetterElement) {
                draggingLetterElement.style.left = `${x}px`;
                draggingLetterElement.style.top = `${y}px`;
            }
        }
        
        // Remove the dragging letter element
        function removeDraggingLetter() {
            if (draggingLetterElement) {
                document.body.removeChild(draggingLetterElement);
                draggingLetterElement = null;
            }
        }
        
        // Touch start handler
        function handleTouchStart(e) {
            e.preventDefault();
            const touch = e.touches[0];
            touchStartX = touch.clientX;
            touchStartY = touch.clientY;
            
            draggedLetter = this;
            draggedLetterIndex = this.dataset.index;
            draggedFromContainer = this.parentElement.id;
            
            this.classList.add("dragging");
            
            // Create a visual element that follows the touch point
            if (draggedFromContainer === "letter-options") {
                createDraggingLetter(this.textContent, touch.clientX, touch.clientY);
            } else if (draggedFromContainer === "letter-container") {
                createDraggingLetter(this.textContent, touch.clientX, touch.clientY);
            }
        }
        
        // Touch move handler
        function handleTouchMove(e) {
            e.preventDefault();
            const touch = e.touches[0];
            
            // Update the position of the dragging letter
            updateDraggingLetterPosition(touch.clientX, touch.clientY);
            
            // Check if it's a significant movement to consider as drag
            const dx = Math.abs(touch.clientX - touchStartX);
            const dy = Math.abs(touch.clientY - touchStartY);
            
            if (dx > 5 || dy > 5) {
                // Find drop target
                const elements = document.elementsFromPoint(touch.clientX, touch.clientY);
                const dropTarget = elements.find(el => el.classList.contains("letter-box"));
                
                // Remove highlight from all boxes
                document.querySelectorAll(".letter-box.highlight").forEach(box => {
                    box.classList.remove("highlight");
                });
                
                // Highlight valid drop target
                if (dropTarget && (dropTarget.textContent === "" || isIncorrectAttempt)) {
                    dropTarget.classList.add("highlight");
                }
            }
        }
        
        // Touch end handler
        function handleTouchEnd(e) {
            e.preventDefault();
            this.classList.remove("dragging");
            
            // Remove the dragging letter element
            removeDraggingLetter();
            
            // Get touch position
            const touch = e.changedTouches[0];
            
            // Find drop target
            const elements = document.elementsFromPoint(touch.clientX, touch.clientY);
            const dropTarget = elements.find(el => el.classList.contains("letter-box"));
            
            // Remove highlight from all boxes
            document.querySelectorAll(".letter-box.highlight").forEach(box => {
                box.classList.remove("highlight");
            });
            
            if (dropTarget) {
                // If dropping from options to word container
                if (draggedFromContainer === "letter-options") {
                    // Check if there's already a letter in this box
                    if (selectedLetters[dropTarget.dataset.index] && !isIncorrectAttempt) {
                        return; // Don't allow overwriting unless it's a retry
                    }
                    
                    // Add to word container
                    dropTarget.textContent = this.textContent;
                    dropTarget.classList.add("filled");
                    selectedLetters[dropTarget.dataset.index] = this.textContent;
                    
                    // Remove from options (unless it's a retry)
                    if (!isIncorrectAttempt) {
                        this.classList.add("hidden");
                    }
                } 
                // If moving between boxes in word container
                else if (draggedFromContainer === "letter-container") {
                    const sourceIndex = draggedLetter.dataset.index;
                    
                    // Swap letters
                    const temp = selectedLetters[sourceIndex];
                    selectedLetters[sourceIndex] = selectedLetters[dropTarget.dataset.index];
                    selectedLetters[dropTarget.dataset.index] = temp;
                    
                    // Update display
                    updateLetterBoxes();
                }
                
                // Clear feedback when letters are moved
                if (isIncorrectAttempt) {
                    resetAfterIncorrect();
                } else {
                    feedbackElement.textContent = "";
                }
            } else if (draggedFromContainer === "letter-container") {
                // If dropping outside of any box, return the letter to options
                returnLetterToOptions(draggedLetter);
            }
        }
        
        // Function to return a letter from container back to options
        function returnLetterToOptions(letterBox) {
            const letter = letterBox.textContent;
            const index = letterBox.dataset.index;
            
            // Find and re-enable the letter option
            for (let i = 0; i < letterOptionsElement.children.length; i++) {
                if (letterOptionsElement.children[i].textContent === letter && 
                    letterOptionsElement.children[i].classList.contains("hidden")) {
                    letterOptionsElement.children[i].classList.remove("hidden");
                    letterOptionsElement.children[i].classList.add("returning");
                    setTimeout(() => {
                        letterOptionsElement.children[i].classList.remove("returning");
                    }, 500);
                    break;
                }
            }
            
            // Clear the box
            letterBox.textContent = "";
            letterBox.classList.remove("filled");
            selectedLetters[index] = null;
            
            if (isIncorrectAttempt) {
                resetAfterIncorrect();
            } else {
                feedbackElement.textContent = "";
            }
        }
        
        // Drag start handler
        function handleDragStart(e) {
            draggedLetter = this;
            draggedLetterIndex = this.dataset.index;
            draggedFromContainer = this.parentElement.id;
            
            setTimeout(() => {
                this.classList.add("dragging");
            }, 0);
            
            e.dataTransfer.setData("text/plain", this.textContent);
            e.dataTransfer.effectAllowed = "move";
        }
        
        // Drag end handler
        function handleDragEnd() {
            this.classList.remove("dragging");
        }
        
        // Drag over handler
        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = "move";
        }
        
        // Drag enter handler
        function handleDragEnter(e) {
            e.preventDefault();
            if (this.textContent === "" || isIncorrectAttempt) {
                this.classList.add("highlight");
            }
        }
        
        // Drag leave handler
        function handleDragLeave() {
            this.classList.remove("highlight");
        }
        
        // Drop handler
        function handleDrop(e) {
            e.preventDefault();
            this.classList.remove("highlight");
            
            const letter = e.dataTransfer.getData("text/plain");
            const targetIndex = this.dataset.index;
            
            // If dropping from options to word container
            if (draggedFromContainer === "letter-options") {
                // Check if there's already a letter in this box
                if (selectedLetters[targetIndex] && !isIncorrectAttempt) {
                    return; // Don't allow overwriting unless it's a retry
                }
                
                // Add to word container
                this.textContent = letter;
                this.classList.add("filled");
                selectedLetters[targetIndex] = letter;
                
                // Remove from options (unless it's a retry)
                if (!isIncorrectAttempt) {
                    draggedLetter.classList.add("hidden");
                }
            } 
            // If moving between boxes in word container
            else if (draggedFromContainer === "letter-container") {
                const sourceIndex = draggedLetter.dataset.index;
                
                // Swap letters
                const temp = selectedLetters[sourceIndex];
                selectedLetters[sourceIndex] = selectedLetters[targetIndex];
                selectedLetters[targetIndex] = temp;
                
                // Update display
                updateLetterBoxes();
            }
            
            // Clear feedback when letters are moved
            if (isIncorrectAttempt) {
                resetAfterIncorrect();
            } else {
                feedbackElement.textContent = "";
            }
        }
        
        // Click handler for letter boxes (to remove letters)
        function handleBoxClick() {
            if (this.textContent !== "") {
                returnLetterToOptions(this);
            }
        }
        
        // Update the letter boxes display
        function updateLetterBoxes() {
            const letterBoxes = letterContainer.children;
            
            for (let i = 0; i < letterBoxes.length; i++) {
                letterBoxes[i].textContent = selectedLetters[i] || "";
                if (selectedLetters[i]) {
                    letterBoxes[i].className = "letter-box filled";
                } else {
                    letterBoxes[i].className = "letter-box";
                }
            }
        }
        
        // Check if the word is correct
        function checkWord() {
            if (selectedLetters.some(letter => letter === null)) {
                feedbackElement.textContent = "Fyll alle boksene!";
                feedbackElement.style.color = "#f44336";
                return;
            }
            
            const userWord = selectedLetters.join("");
            const isCorrect = userWord === currentWord;
            
            // Color the boxes
            const letterBoxes = letterContainer.children;
            for (let i = 0; i < letterBoxes.length; i++) {
                if (isCorrect) {
                    letterBoxes[i].className = "letter-box filled correct";
                } else {
                    letterBoxes[i].className = "letter-box filled incorrect";
                }
            }
            
            // Show feedback
            if (isCorrect) {
                feedbackElement.textContent = "Riktig, godt gjort!";
                feedbackElement.style.color = "#4CAF50";
                tryAgainElement.textContent = "";
                isIncorrectAttempt = false;
            } else {
                feedbackElement.textContent = "Oops! Det er ikke riktig.";
                feedbackElement.style.color = "#f44336";
                tryAgainElement.textContent = "Fjern bokstavene ved klikk på dem og prøve igjen.";
                isIncorrectAttempt = true;
                
                // Show all letter options again for retry
                const options = letterOptionsElement.children;
                for (let i = 0; i < options.length; i++) {
                    options[i].classList.remove("hidden");
                }
            }
        }
        
        // Reset after incorrect attempt
        function resetAfterIncorrect() {
            feedbackElement.textContent = "";
            tryAgainElement.textContent = "";
            isIncorrectAttempt = false;
            
            // Remove incorrect styling
            const letterBoxes = letterContainer.children;
            for (let i = 0; i < letterBoxes.length; i++) {
                if (letterBoxes[i].textContent) {
                    letterBoxes[i].className = "letter-box filled";
                } else {
                    letterBoxes[i].className = "letter-box";
                }
            }
        }
        
        // Event listeners
        checkButton.addEventListener("click", checkWord);
        checkButton.addEventListener("touchstart", function(e) {
            e.preventDefault();
            checkWord();
        }, { passive: false });
        
        resetLettersButton.addEventListener("click", resetLetters);
        resetLettersButton.addEventListener("touchstart", function(e) {
            e.preventDefault();
            resetLetters();
        }, { passive: false });
        
        // Start the game
        initGame();
    </script>
</body>
</html>